<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Women's Health Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        * {
            font-family: 'Inter', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #ffeef8 0%, #ffe5f5 25%, #f3e7ff 50%, #e8dcff 75%, #ffeef8 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(251, 207, 232, 0.2);
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px 0 rgba(251, 207, 232, 0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(255, 107, 157, 0.4);
        }

        .calendar-day {
            transition: all 0.3s ease;
        }

        .calendar-day:hover {
            transform: scale(1.1);
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .timeline-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            position: absolute;
            left: -8px;
            background: #ff6b9d;
            border: 3px solid white;
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0.5) sepia(1) saturate(5) hue-rotate(300deg);
        }

        .fertile-day {
            background: linear-gradient(135deg, #ffd6e8 0%, #ffb3d9 100%);
        }

        .ovulation-day {
            background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);
            color: white;
        }

        .period-day {
            background: linear-gradient(135deg, #c084fc 0%, #9333ea 100%);
            color: white;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <!-- Header -->
    <div class="max-w-6xl mx-auto mb-8">
        <div class="glass-card rounded-3xl p-6 flex flex-col md:flex-row justify-between items-center gap-4">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-pink-500 to-purple-500 bg-clip-text text-transparent" id="app-title">
                    Women's Health Suite
                </h1>
                <p class="text-gray-600 mt-1" id="app-subtitle">Your personal health companion</p>
            </div>

            <!-- Language Switcher -->
            <div class="flex gap-2">
                <button onclick="changeLanguage('en')" class="px-4 py-2 rounded-xl glass-card hover:bg-pink-100 transition-all text-sm font-medium" id="lang-en">ðŸ‡¬ðŸ‡§ EN</button>
                <button onclick="changeLanguage('zh')" class="px-4 py-2 rounded-xl glass-card hover:bg-pink-100 transition-all text-sm font-medium" id="lang-zh">ðŸ‡¨ðŸ‡³ ä¸­æ–‡</button>
                <button onclick="changeLanguage('ja')" class="px-4 py-2 rounded-xl glass-card hover:bg-pink-100 transition-all text-sm font-medium" id="lang-ja">ðŸ‡¯ðŸ‡µ æ—¥æœ¬èªž</button>
                <button onclick="changeLanguage('ko')" class="px-4 py-2 rounded-xl glass-card hover:bg-pink-100 transition-all text-sm font-medium" id="lang-ko">ðŸ‡°ðŸ‡· í•œêµ­ì–´</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-6xl mx-auto grid md:grid-cols-2 gap-8">

        <!-- Ovulation Calculator -->
        <div class="glass-card rounded-3xl p-8 fade-in">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-pink-400 to-pink-600 flex items-center justify-center text-2xl">
                    ðŸŒ¸
                </div>
                <h2 class="text-2xl font-bold text-gray-800" id="ovulation-title">Ovulation Calculator</h2>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" id="last-period-label">Last Period Date</label>
                    <input type="date" id="lastPeriodDate" class="w-full px-4 py-3 rounded-xl border-2 border-pink-200 focus:border-pink-400 focus:outline-none transition-all">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" id="cycle-length-label">Cycle Length (days)</label>
                    <input type="number" id="cycleLength" value="28" min="21" max="35" class="w-full px-4 py-3 rounded-xl border-2 border-pink-200 focus:border-pink-400 focus:outline-none transition-all">
                </div>

                <button onclick="calculateOvulation()" class="w-full btn-primary text-white font-semibold py-4 rounded-xl" id="calc-ovulation-btn">
                    Calculate
                </button>
            </div>

            <!-- Ovulation Results -->
            <div id="ovulationResults" class="mt-6 hidden">
                <div class="bg-gradient-to-r from-pink-50 to-purple-50 rounded-2xl p-6 space-y-4">
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-600" id="ovulation-day-label">Ovulation Day</span>
                        <span class="text-lg font-bold text-pink-600" id="ovulationDay"></span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-600" id="fertile-window-label">Fertile Window</span>
                        <span class="text-sm font-semibold text-purple-600" id="fertileWindow"></span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-600" id="next-period-label">Next Period</span>
                        <span class="text-sm font-semibold text-gray-700" id="nextPeriod"></span>
                    </div>
                </div>

                <!-- Calendar View -->
                <div class="mt-6">
                    <h3 class="font-semibold text-gray-700 mb-3" id="calendar-title">Calendar View</h3>
                    <div class="grid grid-cols-7 gap-1" id="calendarGrid"></div>
                    <div class="mt-4 flex flex-wrap gap-3 text-xs">
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 rounded period-day"></div>
                            <span id="legend-period">Period</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 rounded fertile-day"></div>
                            <span id="legend-fertile">Fertile</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 rounded ovulation-day"></div>
                            <span id="legend-ovulation">Ovulation</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pregnancy Calculator -->
        <div class="glass-card rounded-3xl p-8 fade-in">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-purple-400 to-purple-600 flex items-center justify-center text-2xl">
                    ðŸ‘¶
                </div>
                <h2 class="text-2xl font-bold text-gray-800" id="pregnancy-title">Pregnancy Calculator</h2>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" id="calculation-method-label">Calculation Method</label>
                    <select id="pregnancyMethod" onchange="togglePregnancyInputs()" class="w-full px-4 py-3 rounded-xl border-2 border-purple-200 focus:border-purple-400 focus:outline-none transition-all">
                        <option value="lmp" id="method-lmp">Last Menstrual Period</option>
                        <option value="duedate" id="method-duedate">Due Date</option>
                    </select>
                </div>

                <div id="lmpInput">
                    <label class="block text-sm font-medium text-gray-700 mb-2" id="lmp-date-label">Last Menstrual Period</label>
                    <input type="date" id="lmpDate" class="w-full px-4 py-3 rounded-xl border-2 border-purple-200 focus:border-purple-400 focus:outline-none transition-all">
                </div>

                <div id="dueDateInput" class="hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-2" id="due-date-label">Due Date</label>
                    <input type="date" id="dueDate" class="w-full px-4 py-3 rounded-xl border-2 border-purple-200 focus:border-purple-400 focus:outline-none transition-all">
                </div>

                <button onclick="calculatePregnancy()" class="w-full btn-primary text-white font-semibold py-4 rounded-xl" id="calc-pregnancy-btn">
                    Calculate
                </button>
            </div>

            <!-- Pregnancy Results -->
            <div id="pregnancyResults" class="mt-6 hidden">
                <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-6 space-y-4">
                    <div class="text-center">
                        <div class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent" id="currentWeek"></div>
                        <div class="text-sm text-gray-600 mt-1" id="weeks-label">Weeks</div>
                    </div>

                    <div class="flex items-center justify-between pt-4 border-t border-purple-100">
                        <span class="text-sm font-medium text-gray-600" id="trimester-label">Trimester</span>
                        <span class="text-lg font-bold text-purple-600" id="trimester"></span>
                    </div>

                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-600" id="due-date-result-label">Due Date</span>
                        <span class="text-sm font-semibold text-gray-700" id="dueDateResult"></span>
                    </div>

                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-600" id="days-remaining-label">Days Remaining</span>
                        <span class="text-2xl font-bold text-pink-600" id="daysRemaining"></span>
                    </div>
                </div>

                <!-- Pregnancy Timeline -->
                <div class="mt-6">
                    <h3 class="font-semibold text-gray-700 mb-4" id="timeline-title">Pregnancy Milestones</h3>
                    <div class="relative pl-6 space-y-4" id="pregnancyTimeline">
                        <!-- Timeline items will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Translations
        const translations = {
            en: {
                'app-title': 'Women\'s Health Suite',
                'app-subtitle': 'Your personal health companion',
                'ovulation-title': 'Ovulation Calculator',
                'last-period-label': 'Last Period Date',
                'cycle-length-label': 'Cycle Length (days)',
                'calc-ovulation-btn': 'Calculate',
                'ovulation-day-label': 'Ovulation Day',
                'fertile-window-label': 'Fertile Window',
                'next-period-label': 'Next Period',
                'calendar-title': 'Calendar View',
                'legend-period': 'Period',
                'legend-fertile': 'Fertile',
                'legend-ovulation': 'Ovulation',
                'pregnancy-title': 'Pregnancy Calculator',
                'calculation-method-label': 'Calculation Method',
                'method-lmp': 'Last Menstrual Period',
                'method-duedate': 'Due Date',
                'lmp-date-label': 'Last Menstrual Period',
                'due-date-label': 'Due Date',
                'calc-pregnancy-btn': 'Calculate',
                'weeks-label': 'Weeks',
                'trimester-label': 'Trimester',
                'due-date-result-label': 'Due Date',
                'days-remaining-label': 'Days Remaining',
                'timeline-title': 'Pregnancy Milestones',
                'first-trimester': 'First Trimester',
                'second-trimester': 'Second Trimester',
                'third-trimester': 'Third Trimester'
            },
            zh: {
                'app-title': 'å¥³æ€§å¥åº·åŠ©æ‰‹',
                'app-subtitle': 'æ‚¨çš„ç§äººå¥åº·ä¼´ä¾£',
                'ovulation-title': 'æŽ’åµè®¡ç®—å™¨',
                'last-period-label': 'æœ«æ¬¡æœˆç»æ—¥æœŸ',
                'cycle-length-label': 'å‘¨æœŸé•¿åº¦ï¼ˆå¤©ï¼‰',
                'calc-ovulation-btn': 'è®¡ç®—',
                'ovulation-day-label': 'æŽ’åµæ—¥',
                'fertile-window-label': 'æ˜“å­•æœŸ',
                'next-period-label': 'ä¸‹æ¬¡æœˆç»',
                'calendar-title': 'æ—¥åŽ†è§†å›¾',
                'legend-period': 'æœˆç»æœŸ',
                'legend-fertile': 'æ˜“å­•æœŸ',
                'legend-ovulation': 'æŽ’åµæ—¥',
                'pregnancy-title': 'æ€€å­•è®¡ç®—å™¨',
                'calculation-method-label': 'è®¡ç®—æ–¹å¼',
                'method-lmp': 'æœ«æ¬¡æœˆç»',
                'method-duedate': 'é¢„äº§æœŸ',
                'lmp-date-label': 'æœ«æ¬¡æœˆç»æ—¥æœŸ',
                'due-date-label': 'é¢„äº§æœŸ',
                'calc-pregnancy-btn': 'è®¡ç®—',
                'weeks-label': 'å‘¨',
                'trimester-label': 'å­•æœŸé˜¶æ®µ',
                'due-date-result-label': 'é¢„äº§æœŸ',
                'days-remaining-label': 'å‰©ä½™å¤©æ•°',
                'timeline-title': 'æ€€å­•é‡Œç¨‹ç¢‘',
                'first-trimester': 'æ—©æœŸå¦Šå¨ ',
                'second-trimester': 'ä¸­æœŸå¦Šå¨ ',
                'third-trimester': 'æ™šæœŸå¦Šå¨ '
            },
            ja: {
                'app-title': 'å¥³æ€§ã®å¥åº·ã‚¹ã‚¤ãƒ¼ãƒˆ',
                'app-subtitle': 'ã‚ãªãŸã®å¥åº·ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³',
                'ovulation-title': 'æŽ’åµè¨ˆç®—æ©Ÿ',
                'last-period-label': 'æœ€çµ‚æœˆçµŒæ—¥',
                'cycle-length-label': 'å‘¨æœŸã®é•·ã•ï¼ˆæ—¥ï¼‰',
                'calc-ovulation-btn': 'è¨ˆç®—',
                'ovulation-day-label': 'æŽ’åµæ—¥',
                'fertile-window-label': 'å¦Šå¨ å¯èƒ½æœŸé–“',
                'next-period-label': 'æ¬¡å›žã®ç”Ÿç†',
                'calendar-title': 'ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º',
                'legend-period': 'ç”Ÿç†',
                'legend-fertile': 'å¦Šå¨ å¯èƒ½',
                'legend-ovulation': 'æŽ’åµ',
                'pregnancy-title': 'å¦Šå¨ è¨ˆç®—æ©Ÿ',
                'calculation-method-label': 'è¨ˆç®—æ–¹æ³•',
                'method-lmp': 'æœ€çµ‚æœˆçµŒ',
                'method-duedate': 'å‡ºç”£äºˆå®šæ—¥',
                'lmp-date-label': 'æœ€çµ‚æœˆçµŒæ—¥',
                'due-date-label': 'å‡ºç”£äºˆå®šæ—¥',
                'calc-pregnancy-btn': 'è¨ˆç®—',
                'weeks-label': 'é€±',
                'trimester-label': 'å¦Šå¨ æœŸ',
                'due-date-result-label': 'å‡ºç”£äºˆå®šæ—¥',
                'days-remaining-label': 'æ®‹ã‚Šæ—¥æ•°',
                'timeline-title': 'å¦Šå¨ ãƒžã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³',
                'first-trimester': 'å¦Šå¨ åˆæœŸ',
                'second-trimester': 'å¦Šå¨ ä¸­æœŸ',
                'third-trimester': 'å¦Šå¨ å¾ŒæœŸ'
            },
            ko: {
                'app-title': 'ì—¬ì„± ê±´ê°• ë„ìš°ë¯¸',
                'app-subtitle': 'ë‹¹ì‹ ì˜ ê°œì¸ ê±´ê°• ë™ë°˜ìž',
                'ovulation-title': 'ë°°ëž€ ê³„ì‚°ê¸°',
                'last-period-label': 'ë§ˆì§€ë§‰ ìƒë¦¬ì¼',
                'cycle-length-label': 'ì£¼ê¸° ê¸¸ì´ (ì¼)',
                'calc-ovulation-btn': 'ê³„ì‚°í•˜ê¸°',
                'ovulation-day-label': 'ë°°ëž€ì¼',
                'fertile-window-label': 'ê°€ìž„ê¸°',
                'next-period-label': 'ë‹¤ìŒ ìƒë¦¬',
                'calendar-title': 'ë‹¬ë ¥ ë³´ê¸°',
                'legend-period': 'ìƒë¦¬',
                'legend-fertile': 'ê°€ìž„ê¸°',
                'legend-ovulation': 'ë°°ëž€',
                'pregnancy-title': 'ìž„ì‹  ê³„ì‚°ê¸°',
                'calculation-method-label': 'ê³„ì‚° ë°©ë²•',
                'method-lmp': 'ë§ˆì§€ë§‰ ìƒë¦¬',
                'method-duedate': 'ì¶œì‚° ì˜ˆì •ì¼',
                'lmp-date-label': 'ë§ˆì§€ë§‰ ìƒë¦¬ì¼',
                'due-date-label': 'ì¶œì‚° ì˜ˆì •ì¼',
                'calc-pregnancy-btn': 'ê³„ì‚°í•˜ê¸°',
                'weeks-label': 'ì£¼',
                'trimester-label': 'ìž„ì‹  ë‹¨ê³„',
                'due-date-result-label': 'ì¶œì‚° ì˜ˆì •ì¼',
                'days-remaining-label': 'ë‚¨ì€ ì¼ìˆ˜',
                'timeline-title': 'ìž„ì‹  ì´ì •í‘œ',
                'first-trimester': 'ìž„ì‹  ì´ˆê¸°',
                'second-trimester': 'ìž„ì‹  ì¤‘ê¸°',
                'third-trimester': 'ìž„ì‹  í›„ê¸°'
            }
        };

        let currentLang = localStorage.getItem('language') || 'en';

        // Change Language
        function changeLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('language', lang);

            // Update all text elements
            for (const [key, value] of Object.entries(translations[lang])) {
                const element = document.getElementById(key);
                if (element) {
                    if (element.tagName === 'INPUT' || element.tagName === 'BUTTON') {
                        element.value = value;
                    } else {
                        element.textContent = value;
                    }
                }
            }

            // Update language buttons
            document.querySelectorAll('[id^="lang-"]').forEach(btn => {
                btn.classList.remove('bg-pink-200');
            });
            document.getElementById('lang-' + lang).classList.add('bg-pink-200');
        }

        // Toggle pregnancy inputs
        function togglePregnancyInputs() {
            const method = document.getElementById('pregnancyMethod').value;
            const lmpInput = document.getElementById('lmpInput');
            const dueDateInput = document.getElementById('dueDateInput');

            if (method === 'lmp') {
                lmpInput.classList.remove('hidden');
                dueDateInput.classList.add('hidden');
            } else {
                lmpInput.classList.add('hidden');
                dueDateInput.classList.remove('hidden');
            }
        }

        // Calculate Ovulation
        function calculateOvulation() {
            const lastPeriod = new Date(document.getElementById('lastPeriodDate').value);
            const cycleLength = parseInt(document.getElementById('cycleLength').value);

            if (!lastPeriod || isNaN(cycleLength)) {
                alert(currentLang === 'zh' ? 'è¯·å¡«å†™æ‰€æœ‰å­—æ®µ' :
                      currentLang === 'ja' ? 'ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„' :
                      currentLang === 'ko' ? 'ëª¨ë“  í•„ë“œë¥¼ ìž…ë ¥í•˜ì„¸ìš”' :
                      'Please fill all fields');
                return;
            }

            // Calculate ovulation day (typically 14 days before next period)
            const ovulationDay = new Date(lastPeriod);
            ovulationDay.setDate(ovulationDay.getDate() + (cycleLength - 14));

            // Fertile window: 5 days before ovulation to 1 day after
            const fertileStart = new Date(ovulationDay);
            fertileStart.setDate(fertileStart.getDate() - 5);
            const fertileEnd = new Date(ovulationDay);
            fertileEnd.setDate(fertileEnd.getDate() + 1);

            // Next period
            const nextPeriod = new Date(lastPeriod);
            nextPeriod.setDate(nextPeriod.getDate() + cycleLength);

            // Update results
            document.getElementById('ovulationDay').textContent = formatDate(ovulationDay);
            document.getElementById('fertileWindow').textContent =
                `${formatDate(fertileStart)} - ${formatDate(fertileEnd)}`;
            document.getElementById('nextPeriod').textContent = formatDate(nextPeriod);

            // Generate calendar
            generateCalendar(lastPeriod, ovulationDay, fertileStart, fertileEnd, nextPeriod);

            // Save to localStorage
            localStorage.setItem('ovulationData', JSON.stringify({
                lastPeriod: lastPeriod.toISOString(),
                cycleLength,
                ovulationDay: ovulationDay.toISOString(),
                fertileStart: fertileStart.toISOString(),
                fertileEnd: fertileEnd.toISOString(),
                nextPeriod: nextPeriod.toISOString()
            }));

            document.getElementById('ovulationResults').classList.remove('hidden');
        }

        // Generate Calendar
        function generateCalendar(lastPeriod, ovulationDay, fertileStart, fertileEnd, nextPeriod) {
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';

            // Add day headers with month labels
            const days = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
            days.forEach((day, index) => {
                const header = document.createElement('div');
                header.className = 'text-center text-xs font-semibold text-gray-500 p-2';
                header.textContent = day;
                calendarGrid.appendChild(header);
            });

            // Calculate start date (2 weeks before last period)
            const startDate = new Date(lastPeriod);
            startDate.setDate(startDate.getDate() - 14);

            // Track current month for month headers
            let currentMonth = -1;
            const monthNames = {
                en: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                zh: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'],
                ja: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'],
                ko: ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”']
            };

            // Show 42 days (6 weeks) - 6 rows of 7 days
            for (let week = 0; week < 6; week++) {
                // Check if we need a month header for this week
                const weekStartDate = new Date(startDate);
                weekStartDate.setDate(weekStartDate.getDate() + (week * 7));
                
                if (weekStartDate.getMonth() !== currentMonth) {
                    currentMonth = weekStartDate.getMonth();
                    const monthHeader = document.createElement('div');
                    monthHeader.className = 'col-span-7 text-center text-sm font-bold text-pink-600 py-2 mt-2 border-t border-pink-100';
                    monthHeader.textContent = monthNames[currentLang][currentMonth];
                    calendarGrid.appendChild(monthHeader);
                }

                // Generate 7 days for this week
                for (let dayOfWeek = 0; dayOfWeek < 7; dayOfWeek++) {
                    const i = (week * 7) + dayOfWeek;
                    const currentDate = new Date(startDate);
                    currentDate.setDate(currentDate.getDate() + i);

                    const dayCell = document.createElement('div');
                    dayCell.className = 'calendar-day text-center p-2 rounded-lg text-sm cursor-pointer relative';
                    dayCell.textContent = currentDate.getDate();

                    // Add month indicator for first day of month
                    if (currentDate.getDate() === 1) {
                        dayCell.style.border = '2px solid #ec4899';
                        dayCell.title = monthNames[currentLang][currentDate.getMonth()];
                    }

                    // Style based on significance
                    const currentTime = currentDate.getTime();
                    const periodStart = lastPeriod.getTime();
                    const periodEnd = new Date(lastPeriod.getTime() + 5 * 24 * 60 * 60 * 1000).getTime();

                    if (currentTime >= periodStart && currentTime <= periodEnd) {
                        dayCell.classList.add('period-day');
                    } else if (currentTime === ovulationDay.getTime()) {
                        dayCell.classList.add('ovulation-day');
                    } else if (currentTime >= fertileStart.getTime() && currentTime <= fertileEnd.getTime()) {
                        dayCell.classList.add('fertile-day');
                    } else {
                        dayCell.classList.add('bg-white', 'hover:bg-pink-50');
                    }

                    calendarGrid.appendChild(dayCell);
                }
            }
        }

        // Calculate Pregnancy
        function calculatePregnancy() {
            const method = document.getElementById('pregnancyMethod').value;
            let lmpDate, dueDate;

            if (method === 'lmp') {
                lmpDate = new Date(document.getElementById('lmpDate').value);
                if (!lmpDate || isNaN(lmpDate.getTime())) {
                    alert(currentLang === 'zh' ? 'è¯·è¾“å…¥æœ«æ¬¡æœˆç»æ—¥æœŸ' :
                          currentLang === 'ja' ? 'æœ€çµ‚æœˆçµŒæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„' :
                          currentLang === 'ko' ? 'ë§ˆì§€ë§‰ ìƒë¦¬ì¼ì„ ìž…ë ¥í•˜ì„¸ìš”' :
                          'Please enter last menstrual period');
                    return;
                }
                // Calculate due date (280 days from LMP)
                dueDate = new Date(lmpDate);
                dueDate.setDate(dueDate.getDate() + 280);
            } else {
                dueDate = new Date(document.getElementById('dueDate').value);
                if (!dueDate || isNaN(dueDate.getTime())) {
                    alert(currentLang === 'zh' ? 'è¯·è¾“å…¥é¢„äº§æœŸ' :
                          currentLang === 'ja' ? 'å‡ºç”£äºˆå®šæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„' :
                          currentLang === 'ko' ? 'ì¶œì‚° ì˜ˆì •ì¼ì„ ìž…ë ¥í•˜ì„¸ìš”' :
                          'Please enter due date');
                    return;
                }
                // Calculate LMP (280 days before due date)
                lmpDate = new Date(dueDate);
                lmpDate.setDate(lmpDate.getDate() - 280);
            }

            const today = new Date();
            const daysSinceLMP = Math.floor((today - lmpDate) / (1000 * 60 * 60 * 24));
            const weeks = Math.floor(daysSinceLMP / 7);
            const days = daysSinceLMP % 7;
            const daysRemaining = Math.floor((dueDate - today) / (1000 * 60 * 60 * 24));

            // Determine trimester
            let trimester;
            if (weeks < 13) {
                trimester = translations[currentLang]['first-trimester'];
            } else if (weeks < 27) {
                trimester = translations[currentLang]['second-trimester'];
            } else {
                trimester = translations[currentLang]['third-trimester'];
            }

            // Update results
            document.getElementById('currentWeek').textContent = `${weeks}w ${days}d`;
            document.getElementById('trimester').textContent = trimester;
            document.getElementById('dueDateResult').textContent = formatDate(dueDate);
            document.getElementById('daysRemaining').textContent = daysRemaining > 0 ? daysRemaining : 0;

            // Generate timeline
            generateTimeline(weeks, lmpDate);

            // Save to localStorage
            localStorage.setItem('pregnancyData', JSON.stringify({
                lmpDate: lmpDate.toISOString(),
                dueDate: dueDate.toISOString(),
                weeks,
                trimester
            }));

            document.getElementById('pregnancyResults').classList.remove('hidden');
        }

        // Generate Pregnancy Timeline
        function generateTimeline(currentWeek, lmpDate) {
            const timeline = document.getElementById('pregnancyTimeline');
            timeline.innerHTML = '';

            const milestones = [
                { week: 4, text: { en: 'Positive pregnancy test', zh: 'éªŒå­•æ£’æ˜¾é˜³æ€§', ja: 'å¦Šå¨ æ¤œæŸ»é™½æ€§', ko: 'ìž„ì‹  ê²€ì‚¬ ì–‘ì„±' } },
                { week: 8, text: { en: 'First heartbeat detected', zh: 'é¦–æ¬¡æ£€æµ‹åˆ°å¿ƒè·³', ja: 'æœ€åˆã®å¿ƒæ‹æ¤œå‡º', ko: 'ì²« ì‹¬ë°• ê°ì§€' } },
                { week: 12, text: { en: 'End of first trimester', zh: 'æ—©æœŸå¦Šå¨ ç»“æŸ', ja: 'å¦Šå¨ åˆæœŸçµ‚äº†', ko: 'ìž„ì‹  ì´ˆê¸° ì¢…ë£Œ' } },
                { week: 20, text: { en: 'Anatomy scan', zh: 'è§£å‰–æ‰«æ', ja: 'è§£å‰–å­¦çš„ã‚¹ã‚­ãƒ£ãƒ³', ko: 'í•´ë¶€í•™ ìŠ¤ìº”' } },
                { week: 27, text: { en: 'Third trimester begins', zh: 'æ™šæœŸå¦Šå¨ å¼€å§‹', ja: 'å¦Šå¨ å¾ŒæœŸé–‹å§‹', ko: 'ìž„ì‹  í›„ê¸° ì‹œìž‘' } },
                { week: 36, text: { en: 'Baby drops into pelvis', zh: 'èƒŽå„¿å…¥ç›†', ja: 'èµ¤ã¡ã‚ƒã‚“ãŒéª¨ç›¤ã«é™ã‚Šã‚‹', ko: 'ì•„ê¸°ê°€ ê³¨ë°˜ìœ¼ë¡œ ë‚´ë ¤ê°' } },
                { week: 40, text: { en: 'Due date!', zh: 'é¢„äº§æœŸï¼', ja: 'å‡ºç”£äºˆå®šæ—¥ï¼', ko: 'ì¶œì‚° ì˜ˆì •ì¼!' } }
            ];

            milestones.forEach(milestone => {
                const item = document.createElement('div');
                item.className = `relative pl-6 pb-4 ${currentWeek >= milestone.week ? 'opacity-100' : 'opacity-40'}`;

                const dot = document.createElement('div');
                dot.className = 'timeline-dot';
                if (currentWeek >= milestone.week) {
                    dot.style.background = 'linear-gradient(135deg, #ff6b9d 0%, #c44569 100%)';
                }

                const content = document.createElement('div');
                content.className = 'bg-white rounded-xl p-4';
                content.innerHTML = `
                    <div class="font-semibold text-purple-600">${translations[currentLang]['weeks-label']} ${milestone.week}</div>
                    <div class="text-sm text-gray-600 mt-1">${milestone.text[currentLang]}</div>
                `;

                item.appendChild(dot);
                item.appendChild(content);
                timeline.appendChild(item);
            });
        }

        // Format Date
        function formatDate(date) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return date.toLocaleDateString(currentLang === 'zh' ? 'zh-CN' :
                                          currentLang === 'ja' ? 'ja-JP' :
                                          currentLang === 'ko' ? 'ko-KR' : 'en-US', options);
        }

        // Load saved data on page load
        window.addEventListener('DOMContentLoaded', () => {
            changeLanguage(currentLang);

            // Load ovulation data
            const ovulationData = localStorage.getItem('ovulationData');
            if (ovulationData) {
                const data = JSON.parse(ovulationData);
                document.getElementById('lastPeriodDate').value = data.lastPeriod.split('T')[0];
                document.getElementById('cycleLength').value = data.cycleLength;
                calculateOvulation();
            }

            // Load pregnancy data
            const pregnancyData = localStorage.getItem('pregnancyData');
            if (pregnancyData) {
                const data = JSON.parse(pregnancyData);
                document.getElementById('lmpDate').value = data.lmpDate.split('T')[0];
                calculatePregnancy();
            }
        });
    </script>
</body>
</html>